## 2.3 Groovy 棒球 ##
&#160; &#160; &#160; &#160;图2.4为我们展示了一个叫Groovy棒球的web应用。它是通过你给出一个日期，这个页面就会创造出一个职棒大联盟的地图，这张地图上有比赛的地点、双方球队。比赛结果也会在小板子上列出来。你也可以调整这个日期，它就会用Ajax更新这些数据。

![图2.4](http://i.imgur.com/kxOqTpm.png)

&#160; &#160; &#160; &#160;有一些功能通过JavaScript调用谷歌地图的API完成，例如绘制地图、添加比赛地点标记等。对于给定日期的比赛结果，则通过Ajax调用原生JavaScript类库完成。这些代码我将在以后展示。我将着眼于这个应用中Groovy的部分。

![图2.5](http://i.imgur.com/dYWpaVC.png)

&#160; &#160; &#160; &#160;这个应用是简单的，但他必须有一个合理的结构，所以我将要分几部分来完成它。第一步当然是要去收集MLB场馆的地理信息，并且将它们存在数据库中，就像图2.5展示的那样。

在这一部分中，我将要涉及：
- 展示一下POGO
- 访问一个REST式的web服务
- groovy.sql.Sql 类

下一步是访问在线的分数库，然后将结果粘贴返回的XML文件，就像图2.6那样。

![图2.6](http://i.imgur.com/YXAQE84.png)

在这个阶段中，我们将要讨论：
- 从数据库中读取数据
- 从互联网中下载信息
- 粘贴XML

最后，我需要将返回的数据发向视图层，并且保证它可以理解，就像图2.7那样

![图2.7](http://i.imgur.com/SM0gVZS.png)

在这个阶段，我们将要涉及：
- 用groovylet
- 生成xml

我将开始第一部分，创建POGO，将数据保存到数据库中。
### 数据库数据与旧Groovy对象的展示
这些网上的比赛结果都是以每场比赛的场馆为中心的。谷歌地图是根据所给地理位置的经度纬度绘制标记的。因为比赛场馆不会移动，所以它的位置可以提前保存在某种持久性的结构之中。在这里我用MySQL数据库，你用任何数据库都可以。

我将要写一段脚本来收集每个MLB比赛场馆的必要信息，计算它的经度纬度，并在数据库的表中储存它们。我将要以一个场馆对象为开始。
#### 比赛场馆的POGO
在Java中，我们一般会给这种类叫做java对象或者POJO。在Groovy中，我们将叫它Groovy对象或者是POGO。下面将展示这个Stadium类。
###### 代码清单2.2 Stadium.groovy:一个包含比赛场馆信息的POGO
```groovy
package beans
class Stadium {
	int id
	String name
	String city
	String state
	String team
	double latitude
	double longitude
	String toString() { "($team,$name,$latitude,$longitude)" }
}
```
如果你用过java，你将会发现这里少了一些东西。少了分号可能还没有让你那么惊讶。真正让你震惊的应该是缺少了public和private这些访问权限限定符。在Groovy中如果你不指定访问权限，属性的默认为private，方法默认为public。

你也许也注意到了在Stadium中没有构造方法。在Java中，如果你不添加构造方法，编译器会默认给你一个空的构造方法。在Groovy中，不但给了你空的构造方法，而且还允许你通过键值对的方式指定任意属性的值。

带着这些在脑子里，这是第一部分的脚本，用于填充数据库表中Stadium的位置：
```groovy
def stadiums = []
stadiums <<
	new Stadium(name:'Angel Stadium',city:'Anaheim',state:'CA',team:'ana')
stadiums <<
	new Stadium(name:'Chase Field',city:'Phoenix',state:'AZ',team:'ari')
...
stadiums <<
	new Stadium(name:'Rogers Centre',city:'Toronto',state:'ON',team:'tor')
stadiums <<
	new Stadium(name:'Nationals Park',
	city:'Washington',state:'DC',team:'was')
```
这个*stadium*变量是对一个空的*java.util.ArrayList*的初始化。左移位符*<<*在*Collection*中作为一个附加的方法已经被实现了，接下来的操作就是将每一个MLB场馆对象添加到这个List中。

每个构造器都设置了场馆的*name*、*city*、*state*还有三个字母的球队缩写。没设置的是*latitude*和*longitude*的值。这些将用到Google地理编码（是另一项Google提供的REST式的web服务，类似于我们前面用到的Google图表API）。
>**POGO**  有点类似于Java中的POJO，但是增加了自动生成的getter、setter方法，还有基于map的构造函数。

#### 地理编码
Google地理编码API的文档在
https://developers.google.com/maps/documentation/geocoding/
地理编码能将一个地址转化为经度纬度的形式。要用到Google地理编码你需要组装一个URL，要包括一个地址信息。文档中提到，URL有一个平台
http://maps.googleapis.com/maps/api/geocode/output?parameters
这里*output*的值为*xml*或者*json*，具体的返回类型根据你想返回的类型而定。这个*parameters*属性包含地址也包含一个*sensor*的值。这有个文档中的例子，是谷歌在芒廷维尤 (加利福尼亚州)的地址：
http://maps.googleapis.com/maps/api/geocode/xml?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&sensor=true_or_false